<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Password Quests — daily triage</title>
  <style>
    :root{
      /* deep-blue theme */
      --bg-1:#e9f2ff; --bg-2:#d4e8ff; --card:#ffffff; --muted:#102236; --accent:#2b6cb0; --danger:#ff8a1f; --ok:#2ecc71; --panel:#f1f8ff;
      --shadow:0 12px 36px rgba(16,34,54,.08);
    }
    .dark{--bg-1:#07142a; --bg-2:#062033; --card:#071426; --muted:#c9e6ff; --accent:#4da3ff; --danger:#ff9a4d; --ok:#66d07a; --panel:#092033; --shadow:0 12px 36px rgba(0,0,0,.6)}

  html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial;color:var(--muted);background:linear-gradient(180deg,var(--bg-1),var(--bg-2));}
  .wrap{max-width:1100px;margin:34px auto;padding:20px;padding-bottom:96px}
  header{display:flex;align-items:center;gap:12px;padding:6px 4px}
    h1{margin:0;font-size:20px;color:var(--muted)}
    .controls{margin-left:auto;display:flex;gap:8px;align-items:center}
    .btn{background:var(--accent);color:#111;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}
    .btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(0,0,0,.06)}
  .card{background:var(--card);border-radius:14px;padding:20px;margin-top:18px;box-shadow:var(--shadow)}

  .dashboard{display:flex;gap:16px;align-items:stretch}
  .stat{flex:1;padding:16px;border-radius:12px;background:var(--panel);display:flex;flex-direction:column;gap:8px}
    .stat strong{font-size:18px;color:var(--muted)}
    .progress{height:10px;background:#ddd;border-radius:999px;overflow:hidden}
    .progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#ffc371)}

  /* main layout: left = accounts, right = quests */
  .tasks{display:flex;gap:18px;margin-top:18px;align-items:flex-start}
  .left{flex-basis:48%;min-width:260px}
  .right{flex-basis:48%;min-width:280px;display:flex;flex-direction:column;align-items:center}

  .quest{display:flex;align-items:center;justify-content:space-between;padding:14px;border-radius:12px;background:linear-gradient(180deg,var(--card),#f7fbff);border:1px solid rgba(16,34,54,.04);gap:12px}
    .meta{display:flex;gap:8px;align-items:center}
  .badge{padding:8px 10px;border-radius:10px;font-weight:700;font-size:13px}
  .badge.critical{background:var(--danger);color:#071426}
  .badge.high{background:#ffb974;color:#071426}
  .badge.medium{background:#ffdca8;color:#071426}
  .badge.ok{background:var(--ok);color:#071426}

    .task-actions{display:flex;gap:8px}
    .small{font-size:13px;color:var(--muted)}

  .account-list{display:flex;flex-direction:column;gap:12px;margin-top:16px}
  .account{display:flex;justify-content:space-between;align-items:center;padding:14px;border-radius:10px;background:linear-gradient(180deg,var(--card),#fbfeff);border:1px solid rgba(16,34,54,.04)}
    input[type="text"],input[type="password"],select{padding:8px;border-radius:8px;border:1px solid #ddd;background:transparent;color:var(--muted);min-width:160px}
    .row{display:flex;gap:8px;align-items:center}
    .muted{color:var(--muted)}

  footer{margin-top:18px;color:var(--muted);font-size:13px}

  /* fixed bottom progress */
  .day-progress{position:fixed;left:0;right:0;bottom:0;background:linear-gradient(90deg,var(--bg-2),var(--bg-1));padding:10px 18px;box-shadow:0 -6px 30px rgba(16,34,54,.06)}
  .day-progress .bar{height:12px;background:#e6eefc;border-radius:999px;overflow:hidden;max-width:900px;margin:0 auto}
  .day-progress .bar > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#6fb0ff);}

    .danger{color:var(--danger)}
    .ok{color:var(--ok)}

    /* responsive */
    @media (max-width:880px){.dashboard{flex-direction:column}.right{width:100%}}
  </style>
</head>
<body>
  <div class="wrap" id="app">
    <header>
      <h1>Password Quests — daily triage</h1>
      <div class="controls">
        <label class="muted" style="font-size:13px">Dark</label>
        <input type="checkbox" id="darkToggle" />
        <button class="btn ghost" id="importBtn">Import JSON</button>
        <button class="btn" id="exportBtn">Export state</button>
      </div>
    </header>

    <div class="card">
      <div class="dashboard">
        <div class="stat">
          <div class="small">Compromised accounts</div>
          <strong id="countComp">0</strong>
          <div class="small">Total vulnerable accounts detected</div>
        </div>
        <div class="stat">
          <div class="small">Daily tasks</div>
          <strong id="dailyCount">0 / 3</strong>
          <div class="progress"><i id="progressBar" style="width:0%"></i></div>
          <div class="small">Complete your mini tasks daily to chip away at risk.</div>
        </div>
        <div class="stat">
          <div class="small">Fixed</div>
          <strong id="fixedCount">0</strong>
          <div class="small">Accounts you marked as addressed</div>
        </div>
      </div>

      <div class="tasks">
        <div class="left">
          <h3 style="margin:12px 0 6px 0">All accounts</h3>
          <div id="allArea" class="account-list"></div>
        </div>
        <div class="right">
          <h3 style="margin:12px 0 6px 0">Today's Quests</h3>
          <div id="questsArea" style="width:100%"></div>

          <div style="width:100%;margin-top:18px;background:var(--card);padding:12px;border-radius:10px;box-shadow:var(--shadow)">
            <div class="muted">Instructions</div>
            <p class="small">This prototype helps you break password clean-up into small daily tasks. For each suggested task you can either mark it complete when you've changed the password on the website, or optionally paste the new password into the local manager.</p>
            <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
              <label class="small" style="min-width:110px">Tasks per day</label>
              <select id="tasksPerDay"><option>1</option><option>2</option><option selected>3</option><option>5</option></select>
              <button class="btn" id="resetBtn" style="margin-left:auto">Reset demo data</button>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- fixed day progress bar -->
    <div class="day-progress" role="progressbar" aria-label="Daily progress">
      <div class="bar"><i id="dayProgress" style="width:0%"></i></div>
    </div>

      <footer>
        <div class="muted">All data stays in your browser for this demo. No passwords are sent anywhere.</div>
      </footer>
    </div>
  </div>

  <input type="file" id="fileInput" style="display:none" accept="application/json" />

  <script>
    // Sample demo data
    const SAMPLE = [
      {id:1,site:'bank.example.com',user:'alice',password:'oldpass1',risk:'critical',fixed:false},
      {id:2,site:'social.example.com',user:'alice',password:'alice123',risk:'high',fixed:false},
      {id:3,site:'forum.example.org',user:'bob',password:'qwerty',risk:'medium',fixed:false},
      {id:4,site:'shop.example.net',user:'carol',password:'123456',risk:'high',fixed:false},
      {id:5,site:'photos.example',user:'dave',password:'password',risk:'critical',fixed:false},
      {id:6,site:'blog.example',user:'erin',password:'summer2020',risk:'medium',fixed:false},
      {id:7,site:'mail.example',user:'frank',password:'letmein',risk:'critical',fixed:false},
      {id:8,site:'game.example',user:'gwen',password:'gamer',risk:'medium',fixed:false},
      {id:9,site:'edu.example',user:'hassan',password:'student1',risk:'high',fixed:false},
      {id:10,site:'old.example',user:'irene',password:'oldpass',risk:'medium',fixed:false}
    ];

    // Keys
    const STORAGE_KEY = 'passwordQuests.state.v1';

    // State
    let state = {accounts:[],tasksPerDay:3,history:[]};

    // DOM
    const questsArea = document.getElementById('questsArea');
    const allArea = document.getElementById('allArea');
  const countComp = document.getElementById('countComp');
  const fixedCount = document.getElementById('fixedCount');
  const dailyCount = document.getElementById('dailyCount');
  const dayProgress = document.getElementById('dayProgress');
    const tasksPerDay = document.getElementById('tasksPerDay');
    const resetBtn = document.getElementById('resetBtn');
    const exportBtn = document.getElementById('exportBtn');
    const importBtn = document.getElementById('importBtn');
    const fileInput = document.getElementById('fileInput');
    const darkToggle = document.getElementById('darkToggle');

    // init
    function loadState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw){ state = JSON.parse(raw); }
        else{ state.accounts = SAMPLE.slice(); state.tasksPerDay = 3; saveState(); }
      }catch(e){ console.error('loadState',e); state.accounts = SAMPLE.slice(); }
      tasksPerDay.value = state.tasksPerDay;
      render();
    }
    function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }

    function resetDemo(){ if (!confirm('Reset demo data?')) return; state.accounts = SAMPLE.slice(); state.history = []; saveState(); render(); }

    function countCompromised(){ return state.accounts.filter(a=>!a.fixed && (a.risk==='critical' || a.risk==='high' || a.risk==='medium')).length; }
    function countFixed(){ return state.accounts.filter(a=>a.fixed).length; }

    function pickDailyQuests(){
      const remaining = state.accounts.filter(a=>!a.fixed).slice();
      // priority order: critical, high, medium
      remaining.sort((x,y)=>prio(y.risk)-prio(x.risk));
      const n = parseInt(state.tasksPerDay || 3,10);
      return remaining.slice(0,n);
    }
    function prio(r){ if(r==='critical') return 3; if(r==='high') return 2; if(r==='medium') return 1; return 0; }

    function render(){
      // stats
  countComp.textContent = countCompromised();
  countComp.style.color = countCompromised()>0 ? 'var(--danger)' : 'var(--muted)';
  fixedCount.textContent = countFixed();
  fixedCount.style.color = countFixed()>0 ? 'var(--ok)' : 'var(--muted)';
      const totalComp = state.accounts.filter(a=>a.risk!=='ok').length;
      const fixed = countFixed();
  const pct = totalComp===0?0:Math.round((fixed/totalComp)*100);
  if (dayProgress) dayProgress.style.width = pct + '%';
      dailyCount.textContent = `${Math.min(state.tasksPerDay, pickDailyQuests().length) } / ${state.tasksPerDay}`;

      // quests
      const quests = pickDailyQuests();
      questsArea.innerHTML = '';
      if (quests.length===0) questsArea.innerHTML = '<div class="small muted">No tasks for today — good job!</div>';
      quests.forEach(q=>{
        const el = document.createElement('div'); el.className = 'quest';
        const left = document.createElement('div'); left.className='meta';
        const badge = document.createElement('div'); badge.className='badge ' + (q.risk==='critical'?'critical':q.risk==='high'?'high':'medium'); badge.textContent = q.risk.toUpperCase();
        const title = document.createElement('div'); title.innerHTML = `<strong style="color:var(--muted)">${q.site}</strong><div class="small">${q.user}</div>`;
        left.appendChild(badge); left.appendChild(title);

        const right = document.createElement('div'); right.className='task-actions';
        const mark = document.createElement('button'); mark.className='btn'; mark.textContent='I changed it';
        mark.addEventListener('click', ()=>{ markCompleted(q.id); });
        const record = document.createElement('button'); record.className='btn ghost'; record.textContent='Record new password';
        record.addEventListener('click', ()=>{ openRecordDialog(q.id); });
        right.appendChild(record); right.appendChild(mark);

        el.appendChild(left); el.appendChild(right);
        questsArea.appendChild(el);
      });

      // all
      allArea.innerHTML = '';
      state.accounts.forEach(a=>{
        const ac = document.createElement('div'); ac.className='account';
        const info = document.createElement('div'); info.innerHTML = `<div><strong>${a.site}</strong> <span class="small">${a.user}</span></div><div class="small">risk: ${a.risk}${a.fixed?" — fixed":""}</div>`;
        const actions = document.createElement('div'); actions.className='row';
        const rec = document.createElement('button'); rec.className='btn ghost'; rec.textContent='Record new password'; rec.addEventListener('click', ()=>openRecordDialog(a.id));
        const mark = document.createElement('button'); mark.className='btn'; mark.textContent=a.fixed? 'Mark unresolved' : 'Mark fixed'; mark.addEventListener('click', ()=>{ if(a.fixed) unmark(a.id); else markCompleted(a.id); });
        actions.appendChild(rec); actions.appendChild(mark);
        ac.appendChild(info); ac.appendChild(actions);
        allArea.appendChild(ac);
      });

      saveState();
    }

    function markCompleted(id){
      const a = state.accounts.find(x=>x.id===id); if (!a) return;
      a.fixed = true;
      a.fixedAt = new Date().toISOString();
      state.history.push({id:id,action:'fixed',when:a.fixedAt});
      saveState(); render();
    }
    function unmark(id){ const a=state.accounts.find(x=>x.id===id); if(!a) return; a.fixed=false; a.fixedAt=null; state.history.push({id:id,action:'unfixed',when:new Date().toISOString()}); saveState(); render(); }

    function openRecordDialog(id){
      const a = state.accounts.find(x=>x.id===id); if(!a) return;
      const newpw = prompt(`Enter the new password for ${a.site} (optional). If you don't want to paste it, you can press Cancel and then mark the task manually when you've changed it on the site.`);
      if (newpw===null) return; // user canceled
      // record locally (simulate saving to manager)
      a.password = newpw;
      a.fixed = true;
      a.fixedAt = new Date().toISOString();
      state.history.push({id:id,action:'recorded',when:a.fixedAt});
      // dedupe: if other accounts have same password, warn
      const others = state.accounts.filter(x=>x.id!==id && x.password===newpw);
      if (others.length>0){
        if (confirm('This password matches other accounts. Do you want to mark those as also needing change? (OK = mark them unresolved)')){
          others.forEach(o=>{ o.fixed=false; o.note='needs change due to duplicate pw'; });
        }
      }
      saveState(); render();
    }

    // import/export
    exportBtn.addEventListener('click', ()=>{
      const data = JSON.stringify(state, null, 2);
      const blob = new Blob([data], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      window.open(url, '_blank');
    });
    importBtn.addEventListener('click', ()=> fileInput.click());
    fileInput.addEventListener('change', (e)=>{
      const f = e.target.files[0]; if(!f) return; const reader = new FileReader();
      reader.onload = ()=>{
        try{ const parsed = JSON.parse(reader.result); if(parsed.accounts){ state = parsed; saveState(); render(); alert('Imported demo state.'); } else alert('Invalid file format'); }catch(err){ alert('Error parsing file'); }
      };
      reader.readAsText(f);
    });

    // controls
    resetBtn.addEventListener('click', resetDemo);
    tasksPerDay.addEventListener('change', ()=>{ state.tasksPerDay = parseInt(tasksPerDay.value,10); saveState(); render(); });

    // dark mode
    darkToggle.addEventListener('change',(e)=>{
      if (e.target.checked) document.documentElement.classList.add('dark'); else document.documentElement.classList.remove('dark');
    });

    // init
    loadState();

    // expose for debugging
    window._PQ = {state,render,markCompleted,openRecordDialog};
  </script>
</body>
</html>